<template>
  <div class="space-y-8">
    <!-- 基础用法 -->
    <section>
      <h2 class="text-lg font-medium mb-4">基础用法</h2>
      <div class="flex items-center space-x-4">
        <Dropdown :options="defaultOptions" @select="handleSelect">
          <template #trigger>
            <button class="btn-primary">点击显示下拉菜单</button>
          </template>
        </Dropdown>
        <div v-if="selectedValue" class="text-sm">
          已选择: {{ selectedValue }}
        </div>
      </div>
    </section>

    <!-- 使用DropdownItem子组件 -->
    <section>
      <h2 class="text-lg font-medium mb-4">使用DropdownItem子组件</h2>
      <div class="flex items-center space-x-4">
        <Dropdown @select="handleSelect">
          <template #trigger>
            <button class="btn-primary">使用DropdownItem组件</button>
          </template>
          <DropdownItem value="item1" label="选项一" />
          <DropdownItem value="item2" label="选项二" icon="📝" />
          <DropdownItem divider />
          <DropdownItem value="item3" icon="🌟">
            <span class="text-green-600">自定义内容</span>
          </DropdownItem>
          <DropdownItem value="item4" disabled label="禁用选项" />
        </Dropdown>
      </div>
    </section>

    <!-- 不同触发方式 -->
    <section>
      <h2 class="text-lg font-medium mb-4">不同触发方式</h2>
      <div class="flex flex-wrap gap-4">
        <div>
          <p class="text-sm mb-2">点击触发 (默认)</p>
          <Dropdown trigger="click">
            <template #trigger>
              <button class="btn-secondary">点击触发</button>
            </template>
            <DropdownItem value="click1" label="点击选项1" />
            <DropdownItem value="click2" label="点击选项2" />
          </Dropdown>
        </div>

        <div>
          <p class="text-sm mb-2">悬停触发</p>
          <Dropdown trigger="hover">
            <template #trigger>
              <button class="btn-secondary">悬停触发</button>
            </template>
            <DropdownItem value="hover1" label="悬停选项1" />
            <DropdownItem value="hover2" label="悬停选项2" />
          </Dropdown>
        </div>

        <div>
          <p class="text-sm mb-2">聚焦触发</p>
          <Dropdown trigger="focus">
            <template #trigger>
              <button class="btn-secondary">聚焦触发</button>
            </template>
            <DropdownItem value="focus1" label="聚焦选项1" />
            <DropdownItem value="focus2" label="聚焦选项2" />
          </Dropdown>
        </div>

        <div>
          <p class="text-sm mb-2">手动控制</p>
          <div class="flex items-center gap-2">
            <Dropdown trigger="manual" v-model:visible="manualVisible">
              <template #trigger>
                <button class="btn-secondary">下拉菜单</button>
              </template>
              <DropdownItem value="manual1" label="手动选项1" />
              <DropdownItem value="manual2" label="手动选项2" />
            </Dropdown>
            <button
              class="btn-secondary"
              @click="manualVisible = !manualVisible"
            >
              {{ manualVisible ? '隐藏' : '显示' }}
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- 不同位置 -->
    <section>
      <h2 class="text-lg font-medium mb-4">不同位置</h2>
      <div class="grid grid-cols-3 gap-4">
        <div class="flex justify-center items-center">
          <Dropdown placement="top">
            <template #trigger>
              <button class="btn-secondary">顶部</button>
            </template>
            <DropdownItem value="top1" label="顶部选项1" />
            <DropdownItem value="top2" label="顶部选项2" />
          </Dropdown>
        </div>

        <div class="flex justify-center items-center">
          <Dropdown placement="bottom">
            <template #trigger>
              <button class="btn-secondary">底部</button>
            </template>
            <DropdownItem value="bottom1" label="底部选项1" />
            <DropdownItem value="bottom2" label="底部选项2" />
          </Dropdown>
        </div>

        <div class="flex justify-center items-center">
          <Dropdown placement="left">
            <template #trigger>
              <button class="btn-secondary">左侧</button>
            </template>
            <DropdownItem value="left1" label="左侧选项1" />
            <DropdownItem value="left2" label="左侧选项2" />
          </Dropdown>
        </div>

        <div class="flex justify-center items-center">
          <Dropdown placement="right">
            <template #trigger>
              <button class="btn-secondary">右侧</button>
            </template>
            <DropdownItem value="right1" label="右侧选项1" />
            <DropdownItem value="right2" label="右侧选项2" />
          </Dropdown>
        </div>

        <div class="flex justify-center items-center">
          <Dropdown placement="bottom-start">
            <template #trigger>
              <button class="btn-secondary">底部左对齐</button>
            </template>
            <DropdownItem value="bs1" label="底部左对齐选项1" />
            <DropdownItem value="bs2" label="底部左对齐选项2" />
          </Dropdown>
        </div>

        <div class="flex justify-center items-center">
          <Dropdown placement="bottom-end">
            <template #trigger>
              <button class="btn-secondary">底部右对齐</button>
            </template>
            <DropdownItem value="be1" label="底部右对齐选项1" />
            <DropdownItem value="be2" label="底部右对齐选项2" />
          </Dropdown>
        </div>
      </div>
    </section>

    <!-- 禁用状态 -->
    <section>
      <h2 class="text-lg font-medium mb-4">禁用状态</h2>
      <div class="flex space-x-4">
        <Dropdown disabled>
          <template #trigger>
            <button class="btn-disabled">禁用的下拉菜单</button>
          </template>
          <DropdownItem value="disabled1" label="选项1" />
          <DropdownItem value="disabled2" label="选项2" />
        </Dropdown>

        <Dropdown>
          <template #trigger>
            <button class="btn-secondary">包含禁用选项</button>
          </template>
          <DropdownItem value="normal1" label="正常选项" />
          <DropdownItem value="disabled1" label="禁用选项1" disabled />
          <DropdownItem divider />
          <DropdownItem value="disabled2" label="禁用选项2" disabled />
        </Dropdown>
      </div>
    </section>

    <!-- 带图标的选项 -->
    <section>
      <h2 class="text-lg font-medium mb-4">带图标的选项</h2>
      <Dropdown>
        <template #trigger>
          <button class="btn-primary">操作选项</button>
        </template>
        <DropdownItem value="copy" label="复制" icon="📋" />
        <DropdownItem value="edit" label="编辑" icon="✏️" />
        <DropdownItem value="delete" label="删除" icon="🗑️" />
        <DropdownItem divider />
        <DropdownItem value="download" label="下载" icon="📥" />
      </Dropdown>
    </section>

    <!-- 带分割线的选项 -->
    <section>
      <h2 class="text-lg font-medium mb-4">带分割线的选项</h2>
      <Dropdown>
        <template #trigger>
          <button class="btn-primary">更多操作</button>
        </template>
        <DropdownItem value="view" label="查看详情" icon="👁️" />
        <DropdownItem value="edit" label="编辑" icon="✏️" />
        <DropdownItem divider />
        <DropdownItem value="share" label="分享" icon="🔗" />
        <DropdownItem value="export" label="导出" icon="📤" />
        <DropdownItem divider />
        <DropdownItem value="delete" label="删除" icon="🗑️" />
      </Dropdown>
    </section>

    <!-- 带箭头 -->
    <section>
      <h2 class="text-lg font-medium mb-4">带箭头</h2>
      <Dropdown arrow>
        <template #trigger>
          <button class="btn-secondary">带箭头的下拉菜单</button>
        </template>
        <DropdownItem value="arrow1" label="选项1" />
        <DropdownItem value="arrow2" label="选项2" />
      </Dropdown>
    </section>

    <!-- 键盘导航 -->
    <section>
      <h2 class="text-lg font-medium mb-4">键盘导航</h2>
      <div class="bg-gray-50 p-4 rounded-md mb-4">
        <h3 class="text-sm font-medium text-gray-700 mb-2">支持的键盘操作：</h3>
        <ul class="list-disc pl-5 text-sm text-gray-600 space-y-1">
          <li>
            <strong>Enter/Space</strong>
            ：打开/关闭下拉菜单
          </li>
          <li>
            <strong>↓ (向下箭头)</strong>
            ：聚焦到第一个菜单项
          </li>
          <li>
            <strong>Esc</strong>
            ：关闭菜单
          </li>
          <li>
            <strong>Tab</strong>
            ：切换焦点
          </li>
          <li>
            <strong>Enter/Space</strong>
            ：选择菜单项
          </li>
        </ul>
      </div>
      <div class="flex items-center space-x-4">
        <Dropdown>
          <template #trigger>
            <button class="btn-primary">尝试键盘导航</button>
          </template>
          <DropdownItem value="key1" label="使用键盘进行导航" />
          <DropdownItem value="key2" label="支持Tab键导航" />
          <DropdownItem value="key3" label="使用Enter键选择" />
          <DropdownItem divider />
          <DropdownItem value="key4" label="按Esc键关闭菜单" />
        </Dropdown>
      </div>
    </section>

    <!-- 自定义内容 -->
    <section>
      <h2 class="text-lg font-medium mb-4">自定义内容</h2>
      <Dropdown>
        <template #trigger>
          <button class="btn-primary">自定义内容</button>
        </template>

        <div class="p-4 w-64">
          <h3 class="text-lg font-bold mb-2">自定义下拉内容</h3>
          <p class="text-sm text-gray-500 mb-4">
            这里可以放置任意内容，包括表单、图片等
          </p>
          <div class="mb-3">
            <input
              type="text"
              class="w-full px-3 py-2 border border-gray-300 rounded"
              placeholder="输入内容"
            />
          </div>
          <div class="flex justify-end">
            <button class="btn-sm-primary">确认</button>
          </div>
        </div>
      </Dropdown>
    </section>

    <!-- 自定义样式 -->
    <section>
      <h2 class="text-lg font-medium mb-4">自定义样式 (PT)</h2>
      <Dropdown
        :pt="{
          content: 'bg-purple-50 border border-purple-200 rounded-xl shadow-lg',
          menu: 'py-2',
          menuItem: 'px-4 py-2 text-purple-800 hover:bg-purple-100',
        }"
      >
        <template #trigger>
          <button class="btn-purple">自定义样式</button>
        </template>
        <DropdownItem value="custom1" label="紫色主题选项1" />
        <DropdownItem value="custom2" label="紫色主题选项2" />
        <DropdownItem divider />
        <DropdownItem value="custom3" label="紫色主题选项3" />
      </Dropdown>
    </section>

    <!-- 无样式模式 -->
    <section>
      <h2 class="text-lg font-medium mb-4">无样式模式</h2>
      <Dropdown
        unstyled
        :pt="{
          root: 'relative inline-block',
          trigger: 'inline-flex cursor-pointer',
          content:
            'absolute z-10 mt-2 min-w-[200px] rounded-xl bg-gradient-to-r from-blue-500 to-purple-500 p-0.5',
          menu: 'bg-white rounded-lg overflow-hidden',
          menuItem:
            'block w-full px-4 py-3 text-left text-gray-700 hover:bg-blue-50 hover:text-blue-700 border-b border-gray-100 last:border-b-0 focus:outline-none focus-visible:bg-blue-50 focus-visible:text-blue-700',
          menuItemIcon: 'inline-block mr-2',
          menuDivider: 'border-t border-gray-200 my-1',
        }"
      >
        <template #trigger>
          <div
            class="flex items-center space-x-2 px-4 py-2 bg-gray-100 border border-gray-300 rounded-lg"
          >
            <span>自定义菜单</span>
            <span>▼</span>
          </div>
        </template>
        <DropdownItem value="unstyled1" label="自定义样式选项1" icon="🎨" />
        <DropdownItem value="unstyled2" label="自定义样式选项2" icon="🖌️" />
        <DropdownItem divider />
        <DropdownItem value="unstyled3" label="自定义样式选项3" icon="🎭" />
      </Dropdown>
    </section>

    <!-- 无障碍访问 -->
    <section>
      <h2 class="text-lg font-medium mb-4">无障碍访问 (A11y)</h2>
      <div class="bg-gray-50 p-4 rounded-md mb-4">
        <h3 class="text-sm font-medium text-gray-700 mb-2">无障碍特性：</h3>
        <ul class="list-disc pl-5 text-sm text-gray-600 space-y-1">
          <li>
            <strong>ARIA属性</strong>
            ：包含aria-haspopup、aria-expanded等属性
          </li>
          <li>
            <strong>角色属性</strong>
            ：使用适当的role="menu"和role="menuitem"
          </li>
          <li>
            <strong>键盘导航</strong>
            ：完整支持键盘导航
          </li>
          <li>
            <strong>焦点管理</strong>
            ：清晰的焦点状态
          </li>
        </ul>
      </div>
      <div class="flex items-center space-x-4">
        <Dropdown>
          <template #trigger>
            <button class="btn-primary">无障碍下拉菜单</button>
          </template>
          <DropdownItem value="a11y1" label="屏幕阅读器友好" />
          <DropdownItem value="a11y2" label="键盘可访问" />
          <DropdownItem divider />
          <DropdownItem value="a11y3" label="遵循WCAG 2.1标准" />
        </Dropdown>
      </div>
    </section>

    <!-- 实际应用案例 -->
    <section>
      <h2 class="text-lg font-medium mb-4">实际应用案例: 用户菜单</h2>
      <div class="flex justify-end">
        <Dropdown>
          <template #trigger>
            <div
              class="flex items-center space-x-2 px-3 py-2 bg-white border border-gray-200 rounded-full shadow-sm hover:shadow cursor-pointer"
            >
              <div
                class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white"
              >
                U
              </div>
              <span>用户名</span>
              <span>▼</span>
            </div>
          </template>
          <DropdownItem value="profile" label="个人资料" icon="👤" />
          <DropdownItem value="settings" label="设置" icon="⚙️" />
          <DropdownItem divider />
          <DropdownItem value="help" label="帮助中心" icon="❓" />
          <DropdownItem value="feedback" label="意见反馈" icon="📝" />
          <DropdownItem divider />
          <DropdownItem value="logout" label="退出登录" icon="🚪" />
        </Dropdown>
      </div>
    </section>

    <!-- 与表单结合使用 -->
    <section>
      <h2 class="text-lg font-medium mb-4">与表单结合使用</h2>
      <div class="max-w-md border p-4 rounded-md bg-white">
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-1">
            选择语言
          </label>
          <div class="flex items-center">
            <Dropdown v-model:visible="languageDropdownVisible">
              <template #trigger>
                <button
                  class="w-full flex items-center justify-between px-3 py-2 border border-gray-300 rounded text-left"
                  aria-haspopup="true"
                  :aria-expanded="languageDropdownVisible"
                >
                  <span>{{ selectedLanguage.label || '请选择语言' }}</span>
                  <span>▼</span>
                </button>
              </template>
              <DropdownItem
                v-for="lang in languages"
                :key="lang.value"
                :value="lang"
                :label="lang.label"
                @click="handleLanguageSelect(lang)"
              />
            </Dropdown>
          </div>
          <div class="text-sm text-gray-500 mt-2" v-if="selectedLanguage.value">
            已选择: {{ selectedLanguage.label }} ({{ selectedLanguage.value }})
          </div>
        </div>
      </div>
    </section>

    <!-- 暗黑模式 -->
    <section class="dark bg-gray-900 p-6 rounded-lg">
      <h2 class="text-lg font-medium mb-4 text-white">暗黑模式</h2>
      <div class="flex flex-wrap gap-4">
        <Dropdown>
          <template #trigger>
            <button class="btn-primary">暗黑模式下拉菜单</button>
          </template>
          <DropdownItem value="dark1" label="暗黑模式选项1" />
          <DropdownItem value="dark2" label="暗黑模式选项2" />
          <DropdownItem divider />
          <DropdownItem value="dark3" label="暗黑模式选项3" />
        </Dropdown>

        <Dropdown arrow>
          <template #trigger>
            <button class="btn-secondary">带箭头</button>
          </template>
          <DropdownItem value="darkarrow1" label="带箭头选项1" />
          <DropdownItem value="darkarrow2" label="带箭头选项2" />
        </Dropdown>
      </div>
    </section>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { Dropdown, DropdownItem } from '@versakit/vue'

// 当前选择的值
const selectedValue = ref<any>(null)

// 默认选项
const defaultOptions = [
  { value: 'option1', label: '选项一' },
  { value: 'option2', label: '选项二' },
  { value: 'option3', label: '选项三' },
  { value: 'option4', label: '选项四' },
]

// 手动控制下拉菜单
const manualVisible = ref(false)

// 语言选择示例
const languageDropdownVisible = ref(false)
const selectedLanguage = ref<{ value: string; label: string }>({
  value: '',
  label: '',
})
const languages = [
  { value: 'zh-CN', label: '简体中文' },
  { value: 'en-US', label: '英文' },
  { value: 'ja-JP', label: '日文' },
  { value: 'ko-KR', label: '韩文' },
  { value: 'fr-FR', label: '法文' },
]

// 选择处理函数
const handleSelect = (value: any) => {
  selectedValue.value = value
  console.log('选择了:', value)
}

// 语言选择处理函数
const handleLanguageSelect = (lang: { value: string; label: string }) => {
  selectedLanguage.value = lang
  languageDropdownVisible.value = false
}
</script>

<style scoped>
.btn-primary {
  padding: 0.5rem 1rem;
  background-color: #3b82f6;
  color: white;
  border-radius: 0.25rem;
}

.btn-primary:hover {
  background-color: #2563eb;
}

.btn-primary:focus {
  outline: none;
}

.btn-primary:focus-visible {
  outline: none;
  box-shadow:
    0 0 0 2px #93c5fd,
    0 0 0 4px #3b82f6;
}

.btn-secondary {
  padding: 0.5rem 1rem;
  background-color: #f3f4f6;
  color: #1f2937;
  border: 1px solid #d1d5db;
  border-radius: 0.25rem;
}

.btn-secondary:hover {
  background-color: #e5e7eb;
}

.btn-secondary:focus {
  outline: none;
}

.btn-secondary:focus-visible {
  outline: none;
  box-shadow:
    0 0 0 2px #e5e7eb,
    0 0 0 4px #6b7280;
}

.btn-disabled {
  padding: 0.5rem 1rem;
  background-color: #e5e7eb;
  color: #6b7280;
  border-radius: 0.25rem;
  cursor: not-allowed;
}

.btn-sm-primary {
  padding: 0.25rem 0.75rem;
  background-color: #3b82f6;
  color: white;
  border-radius: 0.25rem;
  font-size: 0.875rem;
}

.btn-sm-primary:hover {
  background-color: #2563eb;
}

.btn-sm-primary:focus {
  outline: none;
}

.btn-sm-primary:focus-visible {
  outline: none;
  box-shadow:
    0 0 0 2px #93c5fd,
    0 0 0 4px #3b82f6;
}

.btn-purple {
  padding: 0.5rem 1rem;
  background-color: #8b5cf6;
  color: white;
  border-radius: 0.25rem;
}

.btn-purple:hover {
  background-color: #7c3aed;
}

.btn-purple:focus {
  outline: none;
}

.btn-purple:focus-visible {
  outline: none;
  box-shadow:
    0 0 0 2px #c4b5fd,
    0 0 0 4px #8b5cf6;
}
</style>
